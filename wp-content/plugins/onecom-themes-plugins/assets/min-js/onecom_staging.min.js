!function(e){function t(){e("#dir_list").length&&e("#dir_list").find(".wpstg-expand-dirs").bind("click",function(t){t.preventDefault(),e(this).hasClass("disabled")||e(this).siblings(".wpstg-subdir").slideToggle()})}function n(){var t={action:"onestg_get_staging",nonce:wpstg.nonce};e.ajax({url:ajaxurl,type:"POST",data:t,error:function(t,n,o){console.log(t.status+" "+t.statusText+"---"+n),e("#onme_errors").html("").html("Failed to get staging details, please reload the page and try again.")},success:function(t){e(document).find("#staging_entry").slideUp().remove(),e("#staging-create").slideUp("fast").before(t),e(".one-staging-msg").removeClass("hide"),window.location.reload()},statusCode:{200:function(){},404:function(){e("#onme_errors").html("").html("Something went wrong; can't find ajax request URL!")},500:function(){e("#onme_errors").html("").html("Something went wrong; internal server error while processing the request!")}}})}function o(){var n={action:"onestg_scanning",nonce:wpstg.nonce};e.ajax({url:ajaxurl,type:"POST",data:n,error:function(e,t,n){console.log(e.status+" "+e.statusText+"---"+t),T()},success:function(n){if(!0===n.error)return void T(n.message);e("#dir_list").html("").html(n),t(),r()},statusCode:{200:function(){},404:function(){e("#onme_errors").html("").html("Something went wrong; can't find ajax request URL!")},500:function(){e("#onme_errors").html("").html("Something went wrong; internal server error while processing the request!")}}})}function r(){var t={action:"onestg_check_disk_space",nonce:wpstg.nonce};e.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:t,error:function(e,t,n){console.log(e.status+" "+e.statusText+"---"+t),T()},success:function(t){return!0===t.error?void T(t.message):!1===t?void e("#onme_errors").text("Can not detect disk space.").show():(m(),void e("#av_space").html("Available free disk space "+t.freespace+" <br> Estimated necessary disk space: "+t.usedspace).show())},statusCode:{200:function(){},404:function(){e("#onme_errors").html("").html("Something went wrong; can't find ajax request URL!")},500:function(){e("#onme_errors").html("").html("Something went wrong; internal server error while processing the request!")}}})}function s(){var t=e("#console_log");void 0!==t[0]&&t.scrollTop(t[0].scrollHeight)}function i(t){null!=t&&void 0!==t&&t.constructor===Array&&e.each(t,function(e,t){null!==t&&t.type}),s()}function a(){var t=[];return e(".onestaging-db-table input:not(:checked)").each(function(){t.push(this.name)}),t}function c(){var t=[];return e(".wpstg-dir input:checked").each(function(){var n=e(this);n.parent(".wpstg-dir").parents(".wpstg-dir").children(".wpstg-expand-dirs").hasClass("disabled")||t.push(n.val())}),t}function l(){var t=[];return e(".wpstg-dir input:not(:checked)").each(function(){var n=e(this);n.parent(".wpstg-dir").parents(".wpstg-dir").children(".wpstg-expand-dirs").hasClass("disabled")||t.push(n.val())}),t}function g(){var t=[];if(!e("#wpstg_extraDirectories").val())return t;var t=e("#wpstg_extraDirectories").val().split(/\r?\n/);return console.log(t),t}function d(t){var n=((new Date).getTime()-j.anyProcess.timer).toFixed(2);n=(n/1e3).toFixed(2),data={action:"onestg_delete_clone",clone:t,nonce:wpstg.nonce,excludedTables:a(),deleteDir:e("#deleteDirectory:checked").val(),totalTime:n},P(wpstg.msgDelStg,0,0),e.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:data,error:function(t,n,o){e("#onme_errors").text("Some error occurred").show(),T(data.message)},success:function(n){if(n){if(void 0!==n.error&&void 0!==n.message)return void T(n.message);if(void 0!==n.delete&&"finished"===n.delete)return P(wpstg.msgDelStg,100,1),e("#entry_"+t).fadeIn(5e3,function(){e(this).remove()}),j.anyProcess.type="",j.anyProcess.active=!1,window.onbeforeunload="",window.location.reload(),e(".onecom-notifier").html("Staging website has been removed.").attr("type","success").addClass("show"),void setTimeout(function(){e(".onecom-notifier").removeClass("show"),e(".one-dialog-close").trigger("click"),e(".one-staging-details").hide(),e(".one-staging-actions").hide(),e("#staging-create").slideDown(),e(".one-card-staging-create").fadeIn(300)},7e3)}if(!0!==n)return void d(t)},statusCode:{404:function(){e("#onme_errors").html("").html("Something went wrong; can't find ajax request URL!")},500:function(){e("#onme_errors").html("").html("Something went wrong; internal server error while processing the request!")}}})}function u(t){if(t){var n=t,o=a(),r=c(),s=l(),i=g();console.log(r),data={action:"onestg_deploy",nonce:wpstg.nonce,liveDirectory:n,excludedTables:o,includedDirectories:r,excludedDirectories:s,extraDirectories:i},e.ajax({url:ajaxurl,type:"POST",data:data,error:function(e,t,n){console.log(e.status+" "+e.statusText),T()},success:function(e){if(void 0!==e.error&&void 0!==e.message)return void T(e.message);p()},statusCode:{404:function(){e("#onme_errors").html("").html("Something went wrong; can't find ajax request URL!")},500:function(){e("#onme_errors").html("").html("Something went wrong; internal server error while processing the request!")}}})}}function h(t){if(t){var n=t,o=a(),r=c(),s=l(),i=g();data={action:"onestg_update",nonce:wpstg.nonce,cloneID:n,excludedTables:o,includedDirectories:r,excludedDirectories:s,extraDirectories:i},console.log("Preparing for UPDATING cloning..."),e.ajax({url:ajaxurl,type:"POST",data:data,error:function(e,t,n){T()},success:function(e){if(void 0!==e.error&&void 0!==e.message)return void T(e.message);p()},statusCode:{404:function(){e("#onme_errors").html("").html("Something went wrong; can't find ajax request URL!")},500:function(){e("#onme_errors").html("").html("Something went wrong; internal server error while processing the request!")}}})}}function m(){P(wpstg.msgPrep,0,0);var t=wpstg.stgID,n=wpstg.stgPrefix,o=a(),r=c(),s=l(),i=g();data={action:"onestg_cloning",nonce:wpstg.nonce,cloneID:t,stgPrefix:n,excludedTables:o,includedDirectories:r,excludedDirectories:s,extraDirectories:i},e.ajax({url:ajaxurl,type:"POST",data:data,error:function(e,t,n){console.log(e.status+" "+e.statusText),T()},success:function(e){if(void 0!==e.error&&void 0!==e.message)return void T(e.message);P(wpstg.msgPrep,100,0),p()},statusCode:{404:function(){e("#onme_errors").html("").html("Something went wrong; can't find ajax request URL!")},500:function(){e("#onme_errors").html("").html("Something went wrong; internal server error while processing the request!")}}})}function p(){P(wpstg.msgNewStg,0,0),setTimeout(function(){P(wpstg.msgCopyDB,0,0),f()},wpstg.cpuLoad)}function f(){!0===j.getLogs&&i(),setTimeout(function(){var t={action:"onestg_clone_database",nonce:wpstg.nonce};e.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:t,error:function(e,t,n){console.log(e.status+" "+e.statusText),T()},success:function(e){if(void 0!==e.error&&void 0!==e.message)return void T(e.message);P(wpstg.msgCopyDB,e.percentage,0),void 0!==e.last_msg&&i(e.last_msg),!1===e.status?setTimeout(function(){f()},wpstg.cpuLoad):!0===e.status&&setTimeout(function(){P(wpstg.msgPrepDirs,0,0),w()},wpstg.cpuLoad)},statusCode:{404:function(){e("#onme_errors").html("").html("Something went wrong; can't find ajax request URL!")},500:function(){e("#onme_errors").html("").html("Something went wrong; internal server error while processing the request!")}}})},500)}function w(){if(!0===j.jobFinished)return!1;!0===j.getLogs&&i(),e("#clone_log").append("Creating Directory Tree...<hr>"),setTimeout(function(){var t={action:"onestg_clone_prepare_directories",nonce:wpstg.nonce};e.ajax({url:ajaxurl,type:"POST",data:t,error:function(e,t,n){T()},success:function(e){if(void 0!==e.error&&void 0!==e.message)return void T(e.message);P(wpstg.msgPrepDirs,e.percentage,0),void 0!==e.last_msg&&i(e.last_msg),!1===e.status?setTimeout(function(){w()},wpstg.cpuLoad):!0===e.status&&(P(wpstg.msgCopyFiles,0,0),v())},statusCode:{404:function(){e("#onme_errors").html("").html("Something went wrong; can't find ajax request URL!")},500:function(){e("#onme_errors").html("").html("Something went wrong; internal server error while processing the request!")}}})},500)}function v(){if(!0===j.jobFinished)return!1;!0===j.getLogs&&i();var t={action:"onestg_clone_files",nonce:wpstg.nonce};e.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:t,error:function(e,t,n){T()},success:function(e){if(void 0!==e.error&&void 0!==e.message)return void T(e.message);void 0!==e.percentage&&P(wpstg.msgCopyFiles,e.percentage,0),void 0!==e.last_msg&&i(e.last_msg),!1===e.status?setTimeout(function(){v()},wpstg.cpuLoad):!0===e.status&&setTimeout(function(){y()},wpstg.cpuLoad)},statusCode:{404:function(){e("#onme_errors").html("").html("Something went wrong; can't find ajax request URL!")},500:function(){e("#onme_errors").html("").html("Something went wrong; internal server error while processing the request!")}}})}function y(){if(!0===j.jobFinished)return!1;!0===j.getLogs&&i();var t={action:"onestg_clone_replace_data",nonce:wpstg.nonce};P(wpstg.msgUpdateDB,0,0),e.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:t,error:function(e,t,n){T()},success:function(e){if(void 0!==e.error&&void 0!==e.message)return void T(e.message);P(wpstg.msgUpdateDB,e.percentage,0),void 0!==e.last_msg&&i(e.last_msg),!1===e.status?setTimeout(function(){y()},wpstg.cpuLoad):!0===e.status&&_()},statusCode:{404:function(){e("#onme_errors").html("").html("Something went wrong; can't find ajax request URL!")},500:function(){e("#onme_errors").html("").html("Something went wrong; internal server error while processing the request!")}}})}function _(t){if(!0===j.jobFinished)return x(t),!1;P(wpstg.msgFinalize,0,0);var o=((new Date).getTime()-j.anyProcess.timer).toFixed(0);o=(o/1e3).toFixed(2);var r={action:"onestg_clone_finish",nonce:wpstg.nonce,totalTime:o};e.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:r,error:function(e,t,n){T(),j.anyProcess.timer=""},success:function(t){if("object"!=typeof t)return console.log("Couldn't finish the cloning process properly. Your snapshot has been copied but failed to do clean up and saving its records to the database."),void(j.anyProcess.timer="");j.anyProcess.type="",j.anyProcess.active=!1,j.anyProcess.timer="",window.onbeforeunload="",n(),e(".onecom-notifier").html(wpstg.copy_msg).attr("type","success").addClass("show"),setTimeout(function(){e(".onecom-notifier").removeClass("show"),e(".one-dialog-close").trigger("click")},3e3),void 0!==t.last_msg&&i(t.last_msg),P(wpstg.msgFinished,100,1),s(),j.jobFinished=!0,_(t)},statusCode:{404:function(){e("#onme_errors").html("").html("Something went wrong; can't find ajax request URL!")},500:function(){e("#onme_errors").html("").html("Something went wrong; internal server error while processing the request!")}}})}function x(t){e("#clone_area_head").find(".spinner").removeClass("is-active"),"undefined"!=t&&"undefined"!=t.url&&e("#onme_errors").html("Staging site created : "+t.url+"/wp-admin/").addClass("green").slideDown(),e(".stopwatch._clone").addClass("done")}function b(){if(!0===j.anyProcess.active)switch(j.anyProcess.type){case"stg":return"Staging creation will get interrupted if you leave or reload this page.";case"live":return"Copy staging to live will get interrupted if you leave or reload this page.";case"delete":return"Staging will not get deleted properly if you leave or reload this page.";case"update":return"Staging updation will get interrupted if you leave or reload this page.";default:return"Please do not leave the page. The current process will get interrupted."}return!0}function T(t){var n=wpstg.error_msg;void 0!==t&&t.length&&(n=t),e(".onecom-notifier").html(n).attr("type","error").addClass("show"),setTimeout(function(){e(".onecom-notifier").removeClass("show"),e(".one-dialog-close").trigger("click")},5e3),S(j.anyProcess.type,n)}function S(t,n){if(t.length){var o=n,r=t,s={action:"onestg_clone_log_error",nonce:wpstg.nonce,stg_action:r,msg:o};e.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:s,error:function(e,t,n){console.log("Could not log the error"),j.anyProcess.type="",j.anyProcess.active=!1,window.onbeforeunload=""},success:function(e){j.anyProcess.type="",j.anyProcess.active=!1,window.onbeforeunload=""}})}}function P(t,n,o){if(t.length){if(e(".loading-overlay.show").find(".onecom_progress_bar").length)e(".loading-overlay.show .onecom_progress_bar .job").html(t),0==n?e(".loading-overlay.show .onecom_progress_bar span").hide().width(n+"%").show():e(".loading-overlay.show .onecom_progress_bar span").width(n+"%");else{var r='<div class="onecom_progress_bar" style="display: none;"><div class="job">'+t+'</div><span style="width:'+n+'%"></span></div>';e(".loading-overlay.show").find(".loader").before(r),e(".loading-overlay.show").find(".onecom_progress_bar").slideDown("fast")}o.length&&1===o&&e(".loading-overlay.show").find(".onecom_progress_bar").slideUp("fast")}}var j={anyProcess:{type:"",active:!1,timer:""},jobFinished:!1,getLogs:!1};window.onbeforeunload="",e(".one-button-create-staging").on("click",function(){e(".loading-overlay.new-staging").addClass("show"),j.anyProcess.type="staging_create",j.anyProcess.active=!0,j.anyProcess.timer=(new Date).getTime(),window.onbeforeunload=b,o()}),e(".one-button-update-staging").click(function(){var t=e(this).attr("data-width"),n=e(this).attr("data-height"),o=e(this).attr("data-dialog-id"),r=e(this).attr("data-title");tb_show(r,"#TB_inline?width="+t+"&height="+n+"&inlineId="+o+"&modal=true&class=thickbox",null)}),e(".one-button-update-staging-confirm").click(function(){e(".loading-overlay.update-loader").addClass("show"),e(".one-dialog-close").trigger("click");var t=e(".one-staging-entry").data("staging-id");t?(j.anyProcess.type="staging_rebuild",j.anyProcess.active=!0,j.anyProcess.timer=(new Date).getTime(),window.onbeforeunload=b,h(t)):(e(".onecom-notifier").html("Error: Staging data not found.").attr("type","error").addClass("show"),setTimeout(function(){e(".onecom-notifier").removeClass("show"),e(".one-dialog-close").trigger("click")},5e3))}),e(".one-button-update-staging-cancel").click(function(){e(this).parents().find(".one-dialog-close").trigger("click")}),e(".one-button-delete-staging").click(function(){var t=e(this).attr("data-width"),n=e(this).attr("data-height"),o=e(this).attr("data-dialog-id"),r=e(this).attr("data-title");tb_show(r,"#TB_inline?width="+t+"&height="+n+"&inlineId="+o+"&modal=true&class=thickbox",null)}),e(".one-button-delete-staging-confirm").click(function(){e(".loading-overlay.delete-loader").first().addClass("show");var t=e(".one-staging-entry").data("staging-id");t?(e(".one-dialog-close").trigger("click"),j.anyProcess.type="staging_delete",j.anyProcess.active=!0,j.anyProcess.timer=(new Date).getTime(),window.onbeforeunload=b,d(t)):(e(".onecom-notifier").html("Error: Staging data not found.").attr("type","error").addClass("show"),setTimeout(function(){e(".onecom-notifier").removeClass("show"),e(".one-dialog-close").trigger("click")},5e3))}),e(".one-button-copy-to-live").click(function(){var t=e(this).attr("data-width"),n=e(this).attr("data-height"),o=e(this).attr("data-dialog-id"),r=e(this).attr("data-title");tb_show(r,"#TB_inline?width="+t+"&height="+n+"&inlineId="+o+"&modal=true&class=thickbox",null)}),e(".one-button-copy-to-live-cancel, .one-button-delete-staging-cancel").click(function(){e(".one-dialog-close").trigger("click")}),e("#one-button-copy-to-live-confirm").on("click",function(){e(".loading-overlay.deploy-loader").addClass("show"),e(".one-dialog-close").trigger("click");var t=e("#deploy_to_live").data("live-id");console.log("Starting deployment Staging-to-Live : "+t),j.anyProcess.type="staging_deploy",j.anyProcess.active=!0,j.anyProcess.timer=(new Date).getTime(),window.onbeforeunload=b,u(t)})}(jQuery);